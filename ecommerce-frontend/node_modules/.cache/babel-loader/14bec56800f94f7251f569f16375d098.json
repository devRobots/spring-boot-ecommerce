{"ast":null,"code":"function _typeof(obj) {\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nimport * as React from 'react';\nimport { polyfill } from 'react-lifecycles-compat';\nimport RcUpload from 'rc-upload';\nimport classNames from 'classnames';\nimport uniqBy from 'lodash/uniqBy';\nimport findIndex from 'lodash/findIndex';\nimport UploadList from './UploadList';\nimport { T, fileToObject, genPercentAdd, getFileItem, removeFileItem } from './utils';\nimport LocaleReceiver from '../locale-provider/LocaleReceiver';\nimport defaultLocale from '../locale/default';\nimport { ConfigConsumer } from '../config-provider';\nimport warning from '../_util/warning';\n\nvar Upload =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Upload, _React$Component);\n\n  function Upload(props) {\n    var _this;\n\n    _classCallCheck(this, Upload);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Upload).call(this, props));\n\n    _this.saveUpload = function (node) {\n      _this.upload = node;\n    };\n\n    _this.onStart = function (file) {\n      var fileList = _this.state.fileList;\n      var targetItem = fileToObject(file);\n      targetItem.status = 'uploading';\n      var nextFileList = fileList.concat();\n      var fileIndex = findIndex(nextFileList, function (_ref) {\n        var uid = _ref.uid;\n        return uid === targetItem.uid;\n      });\n\n      if (fileIndex === -1) {\n        nextFileList.push(targetItem);\n      } else {\n        nextFileList[fileIndex] = targetItem;\n      }\n\n      _this.onChange({\n        file: targetItem,\n        fileList: nextFileList\n      }); // fix ie progress\n\n\n      if (!window.File || process.env.TEST_IE) {\n        _this.autoUpdateProgress(0, targetItem);\n      }\n    };\n\n    _this.onSuccess = function (response, file, xhr) {\n      _this.clearProgressTimer();\n\n      try {\n        if (typeof response === 'string') {\n          response = JSON.parse(response);\n        }\n      } catch (e) {\n        /* do nothing */\n      }\n\n      var fileList = _this.state.fileList;\n      var targetItem = getFileItem(file, fileList); // removed\n\n      if (!targetItem) {\n        return;\n      }\n\n      targetItem.status = 'done';\n      targetItem.response = response;\n      targetItem.xhr = xhr;\n\n      _this.onChange({\n        file: _extends({}, targetItem),\n        fileList: fileList\n      });\n    };\n\n    _this.onProgress = function (e, file) {\n      var fileList = _this.state.fileList;\n      var targetItem = getFileItem(file, fileList); // removed\n\n      if (!targetItem) {\n        return;\n      }\n\n      targetItem.percent = e.percent;\n\n      _this.onChange({\n        event: e,\n        file: _extends({}, targetItem),\n        fileList: fileList\n      });\n    };\n\n    _this.onError = function (error, response, file) {\n      _this.clearProgressTimer();\n\n      var fileList = _this.state.fileList;\n      var targetItem = getFileItem(file, fileList); // removed\n\n      if (!targetItem) {\n        return;\n      }\n\n      targetItem.error = error;\n      targetItem.response = response;\n      targetItem.status = 'error';\n\n      _this.onChange({\n        file: _extends({}, targetItem),\n        fileList: fileList\n      });\n    };\n\n    _this.handleRemove = function (file) {\n      var onRemove = _this.props.onRemove;\n      var fileList = _this.state.fileList;\n      Promise.resolve(typeof onRemove === 'function' ? onRemove(file) : onRemove).then(function (ret) {\n        // Prevent removing file\n        if (ret === false) {\n          return;\n        }\n\n        var removedFileList = removeFileItem(file, fileList);\n\n        if (removedFileList) {\n          file.status = 'removed'; // eslint-disable-line\n\n          if (_this.upload) {\n            _this.upload.abort(file);\n          }\n\n          _this.onChange({\n            file: file,\n            fileList: removedFileList\n          });\n        }\n      });\n    };\n\n    _this.onChange = function (info) {\n      if (!('fileList' in _this.props)) {\n        _this.setState({\n          fileList: info.fileList\n        });\n      }\n\n      var onChange = _this.props.onChange;\n\n      if (onChange) {\n        onChange(info);\n      }\n    };\n\n    _this.onFileDrop = function (e) {\n      _this.setState({\n        dragState: e.type\n      });\n    };\n\n    _this.beforeUpload = function (file, fileList) {\n      var beforeUpload = _this.props.beforeUpload;\n      var stateFileList = _this.state.fileList;\n\n      if (!beforeUpload) {\n        return true;\n      }\n\n      var result = beforeUpload(file, fileList);\n\n      if (result === false) {\n        _this.onChange({\n          file: file,\n          fileList: uniqBy(stateFileList.concat(fileList.map(fileToObject)), function (item) {\n            return item.uid;\n          })\n        });\n\n        return false;\n      }\n\n      if (result && result.then) {\n        return result;\n      }\n\n      return true;\n    };\n\n    _this.renderUploadList = function (locale) {\n      var _this$props = _this.props,\n          showUploadList = _this$props.showUploadList,\n          listType = _this$props.listType,\n          onPreview = _this$props.onPreview,\n          onDownload = _this$props.onDownload,\n          previewFile = _this$props.previewFile,\n          disabled = _this$props.disabled,\n          propLocale = _this$props.locale;\n      var showRemoveIcon = showUploadList.showRemoveIcon,\n          showPreviewIcon = showUploadList.showPreviewIcon,\n          showDownloadIcon = showUploadList.showDownloadIcon;\n      var fileList = _this.state.fileList;\n      return React.createElement(UploadList, {\n        listType: listType,\n        items: fileList,\n        previewFile: previewFile,\n        onPreview: onPreview,\n        onDownload: onDownload,\n        onRemove: _this.handleRemove,\n        showRemoveIcon: !disabled && showRemoveIcon,\n        showPreviewIcon: showPreviewIcon,\n        showDownloadIcon: showDownloadIcon,\n        locale: _extends(_extends({}, locale), propLocale)\n      });\n    };\n\n    _this.renderUpload = function (_ref2) {\n      var _classNames2;\n\n      var getPrefixCls = _ref2.getPrefixCls;\n      var _this$props2 = _this.props,\n          customizePrefixCls = _this$props2.prefixCls,\n          className = _this$props2.className,\n          showUploadList = _this$props2.showUploadList,\n          listType = _this$props2.listType,\n          type = _this$props2.type,\n          disabled = _this$props2.disabled,\n          children = _this$props2.children,\n          style = _this$props2.style;\n      var _this$state = _this.state,\n          fileList = _this$state.fileList,\n          dragState = _this$state.dragState;\n      var prefixCls = getPrefixCls('upload', customizePrefixCls);\n\n      var rcUploadProps = _extends(_extends({\n        onStart: _this.onStart,\n        onError: _this.onError,\n        onProgress: _this.onProgress,\n        onSuccess: _this.onSuccess\n      }, _this.props), {\n        prefixCls: prefixCls,\n        beforeUpload: _this.beforeUpload\n      });\n\n      delete rcUploadProps.className;\n      delete rcUploadProps.style;\n      var uploadList = showUploadList ? React.createElement(LocaleReceiver, {\n        componentName: \"Upload\",\n        defaultLocale: defaultLocale.Upload\n      }, _this.renderUploadList) : null;\n\n      if (type === 'drag') {\n        var _classNames;\n\n        var dragCls = classNames(prefixCls, (_classNames = {}, _defineProperty(_classNames, \"\".concat(prefixCls, \"-drag\"), true), _defineProperty(_classNames, \"\".concat(prefixCls, \"-drag-uploading\"), fileList.some(function (file) {\n          return file.status === 'uploading';\n        })), _defineProperty(_classNames, \"\".concat(prefixCls, \"-drag-hover\"), dragState === 'dragover'), _defineProperty(_classNames, \"\".concat(prefixCls, \"-disabled\"), disabled), _classNames), className);\n        return React.createElement(\"span\", null, React.createElement(\"div\", {\n          className: dragCls,\n          onDrop: _this.onFileDrop,\n          onDragOver: _this.onFileDrop,\n          onDragLeave: _this.onFileDrop,\n          style: style\n        }, React.createElement(RcUpload, _extends({}, rcUploadProps, {\n          ref: _this.saveUpload,\n          className: \"\".concat(prefixCls, \"-btn\")\n        }), React.createElement(\"div\", {\n          className: \"\".concat(prefixCls, \"-drag-container\")\n        }, children))), uploadList);\n      }\n\n      var uploadButtonCls = classNames(prefixCls, (_classNames2 = {}, _defineProperty(_classNames2, \"\".concat(prefixCls, \"-select\"), true), _defineProperty(_classNames2, \"\".concat(prefixCls, \"-select-\").concat(listType), true), _defineProperty(_classNames2, \"\".concat(prefixCls, \"-disabled\"), disabled), _classNames2)); // Remove id to avoid open by label when trigger is hidden\n      // https://github.com/ant-design/ant-design/issues/14298\n      // https://github.com/ant-design/ant-design/issues/16478\n\n      if (!children || disabled) {\n        delete rcUploadProps.id;\n      }\n\n      var uploadButton = React.createElement(\"div\", {\n        className: uploadButtonCls,\n        style: children ? undefined : {\n          display: 'none'\n        }\n      }, React.createElement(RcUpload, _extends({}, rcUploadProps, {\n        ref: _this.saveUpload\n      })));\n\n      if (listType === 'picture-card') {\n        return React.createElement(\"span\", {\n          className: classNames(className, \"\".concat(prefixCls, \"-picture-card-wrapper\"))\n        }, uploadList, uploadButton);\n      }\n\n      return React.createElement(\"span\", {\n        className: className\n      }, uploadButton, uploadList);\n    };\n\n    _this.state = {\n      fileList: props.fileList || props.defaultFileList || [],\n      dragState: 'drop'\n    };\n    warning('fileList' in props || !('value' in props), 'Upload', '`value` is not validate prop, do you mean `fileList`?');\n    return _this;\n  }\n\n  _createClass(Upload, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.clearProgressTimer();\n    }\n  }, {\n    key: \"clearProgressTimer\",\n    value: function clearProgressTimer() {\n      clearInterval(this.progressTimer);\n    }\n  }, {\n    key: \"autoUpdateProgress\",\n    value: function autoUpdateProgress(_, file) {\n      var _this2 = this;\n\n      var getPercent = genPercentAdd();\n      var curPercent = 0;\n      this.clearProgressTimer();\n      this.progressTimer = setInterval(function () {\n        curPercent = getPercent(curPercent);\n\n        _this2.onProgress({\n          percent: curPercent * 100\n        }, file);\n      }, 200);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(ConfigConsumer, null, this.renderUpload);\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(nextProps) {\n      if ('fileList' in nextProps) {\n        return {\n          fileList: nextProps.fileList || []\n        };\n      }\n\n      return null;\n    }\n  }]);\n\n  return Upload;\n}(React.Component);\n\nUpload.defaultProps = {\n  type: 'select',\n  multiple: false,\n  action: '',\n  data: {},\n  accept: '',\n  beforeUpload: T,\n  showUploadList: true,\n  listType: 'text',\n  className: '',\n  disabled: false,\n  supportServerRender: true\n};\npolyfill(Upload);\nexport default Upload;","map":{"version":3,"sources":["upload/Upload.jsx"],"names":["Upload","React","Component","fileList","targetItem","fileToObject","nextFileList","fileIndex","findIndex","uid","file","window","process","response","JSON","getFileItem","e","event","onRemove","Promise","ret","removedFileList","removeFileItem","info","onChange","dragState","type","beforeUpload","stateFileList","result","uniqBy","item","showUploadList","listType","onPreview","onDownload","previewFile","disabled","propLocale","showRemoveIcon","showPreviewIcon","showDownloadIcon","getPrefixCls","customizePrefixCls","className","children","style","prefixCls","rcUploadProps","onStart","onError","onProgress","onSuccess","uploadList","defaultLocale","dragCls","classNames","uploadButtonCls","uploadButton","display","saveUpload","props","warning","nextProps","clearInterval","_","getPercent","genPercentAdd","curPercent","setInterval","percent","multiple","action","data","accept","supportServerRender","polyfill"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { polyfill } from 'react-lifecycles-compat';\nimport RcUpload from 'rc-upload';\nimport classNames from 'classnames';\nimport uniqBy from 'lodash/uniqBy';\nimport findIndex from 'lodash/findIndex';\nimport UploadList from './UploadList';\nimport { T, fileToObject, genPercentAdd, getFileItem, removeFileItem } from './utils';\nimport LocaleReceiver from '../locale-provider/LocaleReceiver';\nimport defaultLocale from '../locale/default';\nimport { ConfigConsumer } from '../config-provider';\nimport warning from '../_util/warning';\nclass Upload extends React.Component {\n    constructor(props) {\n        super(props);\n        this.saveUpload = (node) => {\n            this.upload = node;\n        };\n        this.onStart = (file) => {\n            const { fileList } = this.state;\n            const targetItem = fileToObject(file);\n            targetItem.status = 'uploading';\n            const nextFileList = fileList.concat();\n            const fileIndex = findIndex(nextFileList, ({ uid }) => uid === targetItem.uid);\n            if (fileIndex === -1) {\n                nextFileList.push(targetItem);\n            }\n            else {\n                nextFileList[fileIndex] = targetItem;\n            }\n            this.onChange({\n                file: targetItem,\n                fileList: nextFileList,\n            });\n            // fix ie progress\n            if (!window.File || process.env.TEST_IE) {\n                this.autoUpdateProgress(0, targetItem);\n            }\n        };\n        this.onSuccess = (response, file, xhr) => {\n            this.clearProgressTimer();\n            try {\n                if (typeof response === 'string') {\n                    response = JSON.parse(response);\n                }\n            }\n            catch (e) {\n                /* do nothing */\n            }\n            const { fileList } = this.state;\n            const targetItem = getFileItem(file, fileList);\n            // removed\n            if (!targetItem) {\n                return;\n            }\n            targetItem.status = 'done';\n            targetItem.response = response;\n            targetItem.xhr = xhr;\n            this.onChange({\n                file: Object.assign({}, targetItem),\n                fileList,\n            });\n        };\n        this.onProgress = (e, file) => {\n            const { fileList } = this.state;\n            const targetItem = getFileItem(file, fileList);\n            // removed\n            if (!targetItem) {\n                return;\n            }\n            targetItem.percent = e.percent;\n            this.onChange({\n                event: e,\n                file: Object.assign({}, targetItem),\n                fileList,\n            });\n        };\n        this.onError = (error, response, file) => {\n            this.clearProgressTimer();\n            const { fileList } = this.state;\n            const targetItem = getFileItem(file, fileList);\n            // removed\n            if (!targetItem) {\n                return;\n            }\n            targetItem.error = error;\n            targetItem.response = response;\n            targetItem.status = 'error';\n            this.onChange({\n                file: Object.assign({}, targetItem),\n                fileList,\n            });\n        };\n        this.handleRemove = (file) => {\n            const { onRemove } = this.props;\n            const { fileList } = this.state;\n            Promise.resolve(typeof onRemove === 'function' ? onRemove(file) : onRemove).then(ret => {\n                // Prevent removing file\n                if (ret === false) {\n                    return;\n                }\n                const removedFileList = removeFileItem(file, fileList);\n                if (removedFileList) {\n                    file.status = 'removed'; // eslint-disable-line\n                    if (this.upload) {\n                        this.upload.abort(file);\n                    }\n                    this.onChange({\n                        file,\n                        fileList: removedFileList,\n                    });\n                }\n            });\n        };\n        this.onChange = (info) => {\n            if (!('fileList' in this.props)) {\n                this.setState({ fileList: info.fileList });\n            }\n            const { onChange } = this.props;\n            if (onChange) {\n                onChange(info);\n            }\n        };\n        this.onFileDrop = (e) => {\n            this.setState({\n                dragState: e.type,\n            });\n        };\n        this.beforeUpload = (file, fileList) => {\n            const { beforeUpload } = this.props;\n            const { fileList: stateFileList } = this.state;\n            if (!beforeUpload) {\n                return true;\n            }\n            const result = beforeUpload(file, fileList);\n            if (result === false) {\n                this.onChange({\n                    file,\n                    fileList: uniqBy(stateFileList.concat(fileList.map(fileToObject)), (item) => item.uid),\n                });\n                return false;\n            }\n            if (result && result.then) {\n                return result;\n            }\n            return true;\n        };\n        this.renderUploadList = (locale) => {\n            const { showUploadList, listType, onPreview, onDownload, previewFile, disabled, locale: propLocale, } = this.props;\n            const { showRemoveIcon, showPreviewIcon, showDownloadIcon } = showUploadList;\n            const { fileList } = this.state;\n            return (<UploadList listType={listType} items={fileList} previewFile={previewFile} onPreview={onPreview} onDownload={onDownload} onRemove={this.handleRemove} showRemoveIcon={!disabled && showRemoveIcon} showPreviewIcon={showPreviewIcon} showDownloadIcon={showDownloadIcon} locale={Object.assign(Object.assign({}, locale), propLocale)}/>);\n        };\n        this.renderUpload = ({ getPrefixCls }) => {\n            const { prefixCls: customizePrefixCls, className, showUploadList, listType, type, disabled, children, style, } = this.props;\n            const { fileList, dragState } = this.state;\n            const prefixCls = getPrefixCls('upload', customizePrefixCls);\n            const rcUploadProps = Object.assign(Object.assign({ onStart: this.onStart, onError: this.onError, onProgress: this.onProgress, onSuccess: this.onSuccess }, this.props), { prefixCls, beforeUpload: this.beforeUpload });\n            delete rcUploadProps.className;\n            delete rcUploadProps.style;\n            const uploadList = showUploadList ? (<LocaleReceiver componentName=\"Upload\" defaultLocale={defaultLocale.Upload}>\n        {this.renderUploadList}\n      </LocaleReceiver>) : null;\n            if (type === 'drag') {\n                const dragCls = classNames(prefixCls, {\n                    [`${prefixCls}-drag`]: true,\n                    [`${prefixCls}-drag-uploading`]: fileList.some(file => file.status === 'uploading'),\n                    [`${prefixCls}-drag-hover`]: dragState === 'dragover',\n                    [`${prefixCls}-disabled`]: disabled,\n                }, className);\n                return (<span>\n          <div className={dragCls} onDrop={this.onFileDrop} onDragOver={this.onFileDrop} onDragLeave={this.onFileDrop} style={style}>\n            <RcUpload {...rcUploadProps} ref={this.saveUpload} className={`${prefixCls}-btn`}>\n              <div className={`${prefixCls}-drag-container`}>{children}</div>\n            </RcUpload>\n          </div>\n          {uploadList}\n        </span>);\n            }\n            const uploadButtonCls = classNames(prefixCls, {\n                [`${prefixCls}-select`]: true,\n                [`${prefixCls}-select-${listType}`]: true,\n                [`${prefixCls}-disabled`]: disabled,\n            });\n            // Remove id to avoid open by label when trigger is hidden\n            // https://github.com/ant-design/ant-design/issues/14298\n            // https://github.com/ant-design/ant-design/issues/16478\n            if (!children || disabled) {\n                delete rcUploadProps.id;\n            }\n            const uploadButton = (<div className={uploadButtonCls} style={children ? undefined : { display: 'none' }}>\n        <RcUpload {...rcUploadProps} ref={this.saveUpload}/>\n      </div>);\n            if (listType === 'picture-card') {\n                return (<span className={classNames(className, `${prefixCls}-picture-card-wrapper`)}>\n          {uploadList}\n          {uploadButton}\n        </span>);\n            }\n            return (<span className={className}>\n        {uploadButton}\n        {uploadList}\n      </span>);\n        };\n        this.state = {\n            fileList: props.fileList || props.defaultFileList || [],\n            dragState: 'drop',\n        };\n        warning('fileList' in props || !('value' in props), 'Upload', '`value` is not validate prop, do you mean `fileList`?');\n    }\n    static getDerivedStateFromProps(nextProps) {\n        if ('fileList' in nextProps) {\n            return {\n                fileList: nextProps.fileList || [],\n            };\n        }\n        return null;\n    }\n    componentWillUnmount() {\n        this.clearProgressTimer();\n    }\n    clearProgressTimer() {\n        clearInterval(this.progressTimer);\n    }\n    autoUpdateProgress(_, file) {\n        const getPercent = genPercentAdd();\n        let curPercent = 0;\n        this.clearProgressTimer();\n        this.progressTimer = setInterval(() => {\n            curPercent = getPercent(curPercent);\n            this.onProgress({\n                percent: curPercent * 100,\n            }, file);\n        }, 200);\n    }\n    render() {\n        return <ConfigConsumer>{this.renderUpload}</ConfigConsumer>;\n    }\n}\nUpload.defaultProps = {\n    type: 'select',\n    multiple: false,\n    action: '',\n    data: {},\n    accept: '',\n    beforeUpload: T,\n    showUploadList: true,\n    listType: 'text',\n    className: '',\n    disabled: false,\n    supportServerRender: true,\n};\npolyfill(Upload);\nexport default Upload;\n"]},"metadata":{},"sourceType":"module"}